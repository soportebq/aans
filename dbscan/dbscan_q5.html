<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBSCAN Pregunta 5: M√©trica de Distancia</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 40px;
        }
        .question-box {
            background: #f8f9fa;
            border: 3px solid #9b59b6;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            position: relative;
        }
        .question-box::before {
            content: "‚ùì";
            position: absolute;
            top: -15px;
            left: 25px;
            background: #9b59b6;
            color: white;
            padding: 10px;
            border-radius: 50%;
            font-size: 1.2em;
        }
        .question-box h2 {
            color: #2c3e50;
            margin-top: 0;
            margin-left: 50px;
        }
        .answer-section {
            background: #e8f5e8;
            border: 3px solid #27ae60;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            position: relative;
        }
        .answer-section::before {
            content: "‚úÖ";
            position: absolute;
            top: -15px;
            left: 25px;
            background: #27ae60;
            color: white;
            padding: 10px;
            border-radius: 50%;
            font-size: 1.2em;
        }
        .answer-section h3 {
            color: #27ae60;
            margin-top: 0;
            margin-left: 50px;
            font-size: 1.5em;
        }
        .demo-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .control-group label {
            font-weight: bold;
            color: #2c3e50;
            font-size: 14px;
        }
        .metric-selector {
            padding: 8px 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            cursor: pointer;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        .metric-card {
            border: 3px solid;
            border-radius: 15px;
            padding: 25px;
            background: white;
        }
        .euclidean-card {
            border-color: #3498db;
            background: linear-gradient(135deg, #ebf3fd, #fff);
        }
        .manhattan-card {
            border-color: #e74c3c;
            background: linear-gradient(135deg, #fdf2f2, #fff);
        }
        .great-circle-card {
            border-color: #f39c12;
            background: linear-gradient(135deg, #fef9e7, #fff);
        }
        .metric-card h4 {
            color: var(--card-color);
            margin-top: 0;
            font-size: 1.3em;
            text-align: center;
        }
        .euclidean-card { --card-color: #3498db; }
        .manhattan-card { --card-color: #e74c3c; }
        .great-circle-card { --card-color: #f39c12; }
        .formula-box {
            background: #2c3e50;
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            text-align: center;
            font-size: 16px;
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 25px;
            margin: 30px 0;
        }
        .comparison-card {
            border: 2px solid;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            background: white;
        }
        .euclidean-demo { border-color: #3498db; }
        .manhattan-demo { border-color: #e74c3c; }
        .chebyshev-demo { border-color: #f39c12; }
        .use-cases {
            background: #dff0d8;
            border: 2px solid #5cb85c;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }
        .use-case-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .use-case-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid var(--use-case-color);
        }
        .euclidean-use { --use-case-color: #3498db; }
        .manhattan-use { --use-case-color: #e74c3c; }
        .great-circle-use { --use-case-color: #f39c12; }
        .custom-use { --use-case-color: #9b59b6; }
        .highlight-box {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 3px solid #fdcb6e;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            position: relative;
        }
        .highlight-box::before {
            content: "üí°";
            position: absolute;
            top: -15px;
            left: 25px;
            background: #fdcb6e;
            padding: 10px;
            border-radius: 50%;
            font-size: 1.2em;
        }
        .highlight-box h4 {
            margin-top: 0;
            margin-left: 50px;
            color: #d63031;
        }
        .stats-display {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            text-align: center;
        }
        .stat-item {
            padding: 10px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            font-size: 0.9em;
            color: #7f8c8d;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 12px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            font-size: 14px;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DBSCAN: Pregunta 5</h1>
            <p>¬øQu√© M√©trica de Distancia Utiliza DBSCAN?</p>
        </div>
        
        <div class="content">
            <div class="question-box">
                <h2>¬øQu√© m√©trica de distancia utiliza DBSCAN y se pueden usar otras?</h2>
                <p><strong>Contexto:</strong> La m√©trica de distancia determina c√≥mo se calcula la "cercan√≠a" entre puntos, afectando directamente la formaci√≥n de clusters.</p>
            </div>

            <div class="answer-section">
                <h3>Respuesta: DBSCAN usa Euclidiana por defecto, pero acepta otras m√©tricas</h3>
                <p><strong>Por defecto:</strong> DBSCAN utiliza la <em>distancia Euclidiana</em>, pero el algoritmo es <strong>flexible</strong> y puede usar cualquier m√©trica de distancia apropiada para el tipo de datos y dominio del problema.</p>
            </div>

            <div class="demo-section">
                <h3>üéÆ Demostraci√≥n Interactiva de M√©tricas</h3>
                <p>Selecciona diferentes m√©tricas y observa c√≥mo cambian los resultados:</p>
                
                <div class="controls">
                    <div class="control-group">
                        <label>M√©trica de Distancia</label>
                        <select id="metric-selector" class="metric-selector">
                            <option value="euclidean">Euclidiana (por defecto)</option>
                            <option value="manhattan">Manhattan (L1)</option>
                            <option value="chebyshev">Chebyshev (L‚àû)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Epsilon (Œµ)</label>
                        <input type="range" id="eps-slider" min="30" max="80" value="50" step="5">
                        <span id="eps-value">50</span>
                    </div>
                    <div class="control-group">
                        <label>MinPts</label>
                        <input type="range" id="minpts-slider" min="2" max="8" value="3" step="1">
                        <span id="minpts-value">3</span>
                    </div>
                </div>
                
                <svg id="metrics-demo" width="600" height="400"></svg>
                
                <div class="stats-display">
                    <div class="stat-item">
                        <div class="stat-value" id="current-metric">Euclidiana</div>
                        <div class="stat-label">M√©trica Actual</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="epsilon-used">50</div>
                        <div class="stat-label">Epsilon</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="minpts-used">3</div>
                        <div class="stat-label">MinPts</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="current-clusters">3</div>
                        <div class="stat-label">Clusters</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="current-noise">4</div>
                        <div class="stat-label">Ruido</div>
                    </div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #3498db;"></div>
                    <span>Cluster 1</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e74c3c;"></div>
                    <span>Cluster 2</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f39c12;"></div>
                    <span>Cluster 3</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #9b59b6;"></div>
                    <span>Cluster 4</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #95a5a6;"></div>
                    <span>Ruido</span>
                </div>
            </div>

            <div class="comparison-grid">
                <div class="comparison-card euclidean-demo">
                    <h4 style="color: #3498db;">üìè Euclidiana</h4>
                    <svg id="euclidean-demo" width="200" height="150"></svg>
                    <p>C√≠rculos de vecindad</p>
                    <p><small>Œµ=45, Clusters: 3</small></p>
                </div>

                <div class="comparison-card manhattan-demo">
                    <h4 style="color: #e74c3c;">üè¢ Manhattan</h4>
                    <svg id="manhattan-demo" width="200" height="150"></svg>
                    <p>Rombos de vecindad</p>
                    <p><small>Œµ=45, Clusters: 2</small></p>
                </div>

                <div class="comparison-card chebyshev-demo">
                    <h4 style="color: #f39c12;">‚¨ú Chebyshev</h4>
                    <svg id="chebyshev-demo" width="200" height="150"></svg>
                    <p>Cuadrados de vecindad</p>
                    <p><small>Œµ=45, Clusters: 4</small></p>
                </div>
            </div>

            <div class="metrics-grid">
                <div class="metric-card euclidean-card">
                    <h4>üìè Distancia Euclidiana (Por Defecto)</h4>
                    <div class="formula-box">
                        d = ‚àö[(x‚ÇÇ-x‚ÇÅ)¬≤ + (y‚ÇÇ-y‚ÇÅ)¬≤]
                    </div>
                    <p><strong>Caracter√≠sticas:</strong></p>
                    <ul>
                        <li>Distancia "en l√≠nea recta"</li>
                        <li>M√°s com√∫n en espacios continuos</li>
                        <li>Sensible a todas las dimensiones</li>
                        <li>Forma c√≠rculos de vecindad</li>
                    </ul>
                    <p><strong>Mejor para:</strong> Datos num√©ricos, espacios geom√©tricos</p>
                </div>

                <div class="metric-card manhattan-card">
                    <h4>üè¢ Distancia Manhattan (L1)</h4>
                    <div class="formula-box">
                        d = |x‚ÇÇ-x‚ÇÅ| + |y‚ÇÇ-y‚ÇÅ|
                    </div>
                    <p><strong>Caracter√≠sticas:</strong></p>
                    <ul>
                        <li>Suma de diferencias absolutas</li>
                        <li>Movimiento tipo "taxi" en cuadr√≠cula</li>
                        <li>Menos sensible a outliers</li>
                        <li>Forma rombos de vecindad</li>
                    </ul>
                    <p><strong>Mejor para:</strong> Datos categ√≥ricos, grids urbanos</p>
                </div>

                <div class="metric-card great-circle-card">
                    <h4>üåç Distancia de Gran C√≠rculo</h4>
                    <div class="formula-box">
                        d = 2r √ó arcsin(‚àö[sin¬≤(ŒîœÜ/2) + cos(œÜ‚ÇÅ)cos(œÜ‚ÇÇ)sin¬≤(ŒîŒª/2)])
                    </div>
                    <p><strong>Caracter√≠sticas:</strong></p>
                    <ul>
                        <li>Para coordenadas geogr√°ficas</li>
                        <li>Considera curvatura terrestre</li>
                        <li>Distancia real en la superficie</li>
                        <li>Esencial para datos GPS</li>
                    </ul>
                    <p><strong>Mejor para:</strong> Datos geogr√°ficos, ubicaciones GPS</p>
                </div>
            </div>

            <div class="use-cases">
                <h3>üéØ Casos de Uso por M√©trica</h3>
                <div class="use-case-grid">
                    <div class="use-case-card euclidean-use">
                        <h5>üìè Euclidiana</h5>
                        <ul>
                            <li>An√°lisis de im√°genes</li>
                            <li>Datos cient√≠ficos continuos</li>
                            <li>Coordenadas cartesianas</li>
                            <li>Mediciones f√≠sicas</li>
                        </ul>
                    </div>
                    
                    <div class="use-case-card manhattan-use">
                        <h5>üè¢ Manhattan</h5>
                        <ul>
                            <li>Datos categ√≥ricos ordinales</li>
                            <li>Sistemas de recomendaci√≥n</li>
                            <li>An√°lisis de redes urbanas</li>
                            <li>Datos con ruido</li>
                        </ul>
                    </div>
                    
                    <div class="use-case-card great-circle-use">
                        <h5>üåç Gran C√≠rculo</h5>
                        <ul>
                            <li>An√°lisis geoespacial</li>
                            <li>Tracking GPS</li>
                            <li>Estudios clim√°ticos</li>
                            <li>Log√≠stica y transporte</li>
                        </ul>
                    </div>
                    
                    <div class="use-case-card custom-use">
                        <h5>‚öôÔ∏è M√©tricas Personalizadas</h5>
                        <ul>
                            <li>Distancia coseno (texto)</li>
                            <li>Distancia Hamming (binarios)</li>
                            <li>Distancia Jaccard (conjuntos)</li>
                            <li>M√©tricas del dominio espec√≠fico</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="highlight-box">
                <h4>Selecci√≥n de M√©trica: Consideraciones Clave</h4>
                <p><strong>Factores importantes para elegir la m√©trica correcta:</strong></p>
                <ul>
                    <li><strong>Tipo de datos:</strong> Num√©ricos vs categ√≥ricos vs geogr√°ficos</li>
                    <li><strong>Dimensionalidad:</strong> Algunas m√©tricas sufren de "maldici√≥n de dimensionalidad"</li>
                    <li><strong>Escala:</strong> Normalizaci√≥n puede ser necesaria con Euclidiana</li>
                    <li><strong>Dominio:</strong> Conocimiento espec√≠fico del problema</li>
                    <li><strong>Interpretabilidad:</strong> Qu√© significa "similitud" en el contexto</li>
                    <li><strong>Eficiencia:</strong> Algunas m√©tricas son m√°s costosas computacionalmente</li>
                </ul>
            </div>

            <div class="answer-section">
                <h3>üìù Resumen Ejecutivo</h3>
                
                <h4>‚úÖ Respuesta Directa:</h4>
                <p>DBSCAN utiliza <strong>distancia Euclidiana por defecto</strong>, pero es <em>completamente flexible</em> para usar cualquier m√©trica de distancia apropiada.</p>

                <h4>üîß Implementaci√≥n Pr√°ctica:</h4>
                <ul>
                    <li><strong>Scikit-learn:</strong> Par√°metro <code>metric='euclidean'</code> (por defecto)</li>
                    <li><strong>Opciones comunes:</strong> 'manhattan', 'chebyshev', 'minkowski', 'cosine'</li>
                    <li><strong>M√©tricas personalizadas:</strong> Se pueden definir funciones propias</li>
                </ul>

                <h4>‚öñÔ∏è Impacto en Resultados:</h4>
                <ul>
                    <li>La m√©trica afecta <strong>significativamente</strong> la formaci√≥n de clusters</li>
                    <li>Mismo epsilon puede producir resultados muy diferentes</li>
                    <li>Selecci√≥n incorrecta puede llevar a clustering inv√°lido</li>
                </ul>

                <h4>üí° Recomendaci√≥n:</h4>
                <p>Siempre <strong>experimentar con m√∫ltiples m√©tricas</strong> y seleccionar la que mejor se adapte al dominio espec√≠fico y tipo de datos del problema.</p>
            </div>
        </div>
    </div>

    <script>
        // Datos de ejemplo mejorados y m√°s sensibles a MinPts
        const sampleData = [
            // Cluster 1 (izquierda-arriba) - DENSO, 6 puntos
            {x: 150, y: 120, id: 1}, {x: 170, y: 130, id: 2}, {x: 160, y: 110, id: 3},
            {x: 180, y: 125, id: 4}, {x: 145, y: 140, id: 5}, {x: 165, y: 135, id: 6},
            
            // Cluster 2 (derecha-arriba) - MODERADO, 5 puntos
            {x: 420, y: 130, id: 7}, {x: 440, y: 140, id: 8}, {x: 430, y: 120, id: 9},
            {x: 450, y: 135, id: 10}, {x: 415, y: 150, id: 11},
            
            // Cluster 3 (centro-abajo) - DENSO, 6 puntos
            {x: 280, y: 300, id: 12}, {x: 300, y: 310, id: 13}, {x: 290, y: 290, id: 14},
            {x: 310, y: 305, id: 15}, {x: 275, y: 320, id: 16}, {x: 295, y: 285, id: 17},
            
            // Cluster 4 (izquierda-centro) - DISPERSO, 4 puntos
            {x: 120, y: 220, id: 18}, {x: 140, y: 240, id: 19}, {x: 110, y: 250, id: 20},
            {x: 130, y: 260, id: 21},
            
            // Puntos aislados (outliers)
            {x: 220, y: 180, id: 22}, {x: 360, y: 200, id: 23}, {x: 500, y: 280, id: 24},
            {x: 80, y: 350, id: 25}, {x: 520, y: 80, id: 26}
        ];

        // Funciones de distancia
        const metrics = {
            euclidean: (p1, p2) => Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2)),
            manhattan: (p1, p2) => Math.abs(p1.x - p2.x) + Math.abs(p1.y - p2.y),
            chebyshev: (p1, p2) => Math.max(Math.abs(p1.x - p2.x), Math.abs(p1.y - p2.y))
        };

        // DBSCAN con m√©trica personalizable
        function dbscanWithMetric(points, eps, minPts, metric) {
            const result = points.map(p => ({...p, cluster: 'noise', neighbors: 0, isCore: false}));
            const distFunc = metrics[metric];
            
            result.forEach(point => {
                const neighbors = result.filter(other => 
                    other.id !== point.id && distFunc(point, other) <= eps
                );
                point.neighbors = neighbors.length;
                point.isCore = neighbors.length >= minPts;
            });
            
            let clusterIndex = 1;
            const visited = new Set();
            
            result.forEach(point => {
                if (point.isCore && !visited.has(point.id)) {
                    const stack = [point];
                    point.cluster = `cluster${clusterIndex}`;
                    visited.add(point.id);
                    
                    while (stack.length > 0) {
                        const current = stack.pop();
                        const neighbors = result.filter(other => 
                            other.id !== current.id && distFunc(current, other) <= eps
                        );
                        
                        neighbors.forEach(neighbor => {
                            if (!visited.has(neighbor.id)) {
                                visited.add(neighbor.id);
                                neighbor.cluster = `cluster${clusterIndex}`;
                                if (neighbor.isCore) {
                                    stack.push(neighbor);
                                }
                            }
                        });
                    }
                    clusterIndex++;
                }
            });
            
            return result;
        }

        // Crear visualizaci√≥n
        function createVisualization(svgId, points, eps, metric, scale = 1) {
            const svg = d3.select(`#${svgId}`);
            svg.selectAll("*").remove();
            
            const colors = {
                cluster1: '#3498db', cluster2: '#e74c3c', cluster3: '#f39c12',
                cluster4: '#9b59b6', noise: '#95a5a6'
            };
            
            console.log(`Creando visualizaci√≥n en ${svgId} con m√©trica ${metric}, eps=${eps}, ${points.length} puntos`);
            
            // Mostrar forma de vecindad para TODOS los core points (solo en demo principal)
            if (scale === 1) {
                const corePoints = points.filter(p => p.isCore);
                console.log(`üîµ Core points encontrados: ${corePoints.length}`, corePoints.map(p => p.id));
                
                // Mostrar TODOS los core points pero con diferente intensidad
                corePoints.forEach((centerPoint, index) => {
                    const opacity = Math.max(0.3, 0.8 - (index * 0.1)); // Degradar opacidad
                    
                    console.log(`Dibujando forma ${metric} para core point ${centerPoint.id} en (${centerPoint.x}, ${centerPoint.y})`);
                    
                    if (metric === 'euclidean') {
                        svg.append("circle")
                            .attr("cx", centerPoint.x)
                            .attr("cy", centerPoint.y)
                            .attr("r", eps)
                            .attr("fill", "rgba(52,152,219,0.03)")
                            .attr("stroke", "#3498db")
                            .attr("stroke-width", 1.5)
                            .attr("stroke-dasharray", "4,4")
                            .attr("opacity", opacity);
                    } else if (metric === 'manhattan') {
                        const pointsStr = `${centerPoint.x},${centerPoint.y-eps} ${centerPoint.x+eps},${centerPoint.y} ${centerPoint.x},${centerPoint.y+eps} ${centerPoint.x-eps},${centerPoint.y}`;
                        svg.append("polygon")
                            .attr("points", pointsStr)
                            .attr("fill", "rgba(231,76,60,0.03)")
                            .attr("stroke", "#e74c3c")
                            .attr("stroke-width", 1.5)
                            .attr("stroke-dasharray", "4,4")
                            .attr("opacity", opacity);
                    } else if (metric === 'chebyshev') {
                        svg.append("rect")
                            .attr("x", centerPoint.x - eps)
                            .attr("y", centerPoint.y - eps)
                            .attr("width", eps * 2)
                            .attr("height", eps * 2)
                            .attr("fill", "rgba(243,156,18,0.03)")
                            .attr("stroke", "#f39c12")
                            .attr("stroke-width", 1.5)
                            .attr("stroke-dasharray", "4,4")
                            .attr("opacity", opacity);
                    }
                });
            }
            
            // Dibujar puntos
            svg.selectAll(".point")
                .data(points)
                .enter()
                .append("circle")
                .attr("class", "point")
                .attr("cx", d => d.x * scale)
                .attr("cy", d => d.y * scale)
                .attr("r", d => (d.isCore ? 8 : 6) * scale)
                .attr("fill", d => colors[d.cluster] || colors.noise)
                .attr("stroke", "#2c3e50")
                .attr("stroke-width", 1.5 * scale)
                .style("cursor", scale === 1 ? "pointer" : "default");
            
            // Agregar tooltips solo al gr√°fico principal
            if (scale === 1) {
                svg.selectAll(".point")
                    .on("mouseover", function(event, d) {
                        d3.select(this).attr("r", d.isCore ? 12 : 9);
                        
                        const tooltip = svg.append("g").attr("id", "tooltip");
                        tooltip.append("rect")
                            .attr("x", d.x + 15)
                            .attr("y", d.y - 50)
                            .attr("width", 140)
                            .attr("height", 70)
                            .attr("fill", "rgba(0,0,0,0.9)")
                            .attr("rx", 8);
                        
                        tooltip.append("text")
                            .attr("x", d.x + 25)
                            .attr("y", d.y - 30)
                            .attr("fill", "white")
                            .attr("font-size", "12px")
                            .attr("font-weight", "bold")
                            .text(`${d.isCore ? 'Core' : 'Border/Noise'}`);
                        
                        tooltip.append("text")
                            .attr("x", d.x + 25)
                            .attr("y", d.y - 15)
                            .attr("fill", "white")
                            .attr("font-size", "11px")
                            .text(`Neighbors: ${d.neighbors}`);
                        
                        tooltip.append("text")
                            .attr("x", d.x + 25)
                            .attr("y", d.y)
                            .attr("fill", "white")
                            .attr("font-size", "11px")
                            .text(`Cluster: ${d.cluster}`);
                    })
                    .on("mouseout", function(event, d) {
                        d3.select(this).attr("r", d.isCore ? 8 : 6);
                        svg.select("#tooltip").remove();
                    });
            }
            
            console.log(`Visualizaci√≥n ${svgId} creada con ${points.length} puntos`);
            return points;
        }

        // Actualizar demo principal
        function updateDemo() {
            const metric = document.getElementById('metric-selector').value;
            const eps = parseInt(document.getElementById('eps-slider').value);
            const minPts = parseInt(document.getElementById('minpts-slider').value);
            
            console.log(`üîÑ Actualizando demo: m√©trica=${metric}, eps=${eps}, minPts=${minPts}`);
            
            document.getElementById('eps-value').textContent = eps;
            document.getElementById('minpts-value').textContent = minPts;
            
            const points = dbscanWithMetric(sampleData, eps, minPts, metric);
            console.log(`üìä DBSCAN completado: ${points.length} puntos procesados`);
            
            createVisualization('metrics-demo', points, eps, metric, 1);
            
            // Actualizar estad√≠sticas
            const clusterCount = new Set(points.filter(p => p.cluster !== 'noise').map(p => p.cluster)).size;
            const noiseCount = points.filter(p => p.cluster === 'noise').length;
            const coreCount = points.filter(p => p.isCore).length;
            
            console.log(`üìà Resultados: ${clusterCount} clusters, ${noiseCount} noise, ${coreCount} core points`);
            
            const metricNames = {
                euclidean: 'Euclidiana',
                manhattan: 'Manhattan', 
                chebyshev: 'Chebyshev'
            };
            
            document.getElementById('current-metric').textContent = metricNames[metric];
            document.getElementById('current-clusters').textContent = clusterCount;
            document.getElementById('current-noise').textContent = noiseCount;
            document.getElementById('epsilon-used').textContent = eps;
            document.getElementById('minpts-used').textContent = minPts;
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            // Crear comparaciones est√°ticas
            createVisualization('euclidean-demo', dbscanWithMetric(sampleData, 45, 3, 'euclidean'), 45, 'euclidean', 0.5);
            createVisualization('manhattan-demo', dbscanWithMetric(sampleData, 45, 3, 'manhattan'), 45, 'manhattan', 0.5);
            createVisualization('chebyshev-demo', dbscanWithMetric(sampleData, 45, 3, 'chebyshev'), 45, 'chebyshev', 0.5);
            
            // Event listeners
            document.getElementById('metric-selector').addEventListener('change', updateDemo);
            document.getElementById('eps-slider').addEventListener('input', updateDemo);
            document.getElementById('minpts-slider').addEventListener('input', updateDemo);
            
            // Crear demo inicial
            updateDemo();
            
            console.log("Demo de m√©tricas DBSCAN cargada correctamente!");
        });
    </script>
</body>
</html>